# Inverse‑Pair Finder: Sector Rotation & Hedge Analysis

This repository identifies and visualizes pairs of assets that move inversely—helpful for hedging, sector‑rotation studies, and quantitative trading strategies. We scan a universe of equities (or ETFs), compute pairwise Pearson correlations on returns, and produce both normalized‑price charts and return‑scatter plots for the strongest inverse relationships.

---

## Project Objectives

1. **Compute Pairwise Correlations**  
   - Convert price series to returns at your chosen frequency (daily, weekly, bi‑weekly, etc.)  
   - Calculate Pearson *r* and p‑values for every pair in the universe  

2. **Filter for Inverse Pairs**  
   - Select pairs with correlation ≤ –threshold and statistically meaningful p‑values  
   - Focus on the top *N* most inverse relationships for further analysis  

3. **Visualize Results**  
   - Generate normalized‑price plots showing one asset at 100 and the other’s inverse drift  
   - Create daily‑return scatter plots with regression lines, slopes, and r‑values in the legend  

4. **Support Interactive Exploration**  
   - Provide a CLI to plot specific ticker pairs on demand  
   - Offer a consolidated multi‑panel view of the top inverse pairs  

---

## Core Files

| File                   | Description                                                                                  |
|------------------------|----------------------------------------------------------------------------------------------|
| `src/pipeline.py`      | Ingests raw price CSVs, computes returns, calculates all correlations, and writes to `correlations/correlations.json`. |
| `src/plot_pairs.py`    | CLI script: loads `correlations/correlations.json` and plots the top N inverse pairs to `result/`. |
| `src/analyzer.py`      | Helper functions for ranking and filtering correlations.                                     |
| `data/`                | Contains raw price data as CSV files (`<TICKER>.csv`).                                       |
| `correlations/`        | Stores the output JSON from the pipeline (`correlations.json`).                              |
| `result/`              | Stores the output plots generated by `plot_pairs.py`.                                        |

---
### Multithreaded Correlation Engine

To accelerate the computation of over 120,000 pairwise correlations, the core of `pipeline.py` employs Python’s `concurrent.futures.ThreadPoolExecutor`. After filtering out assets with insufficient overlapping data, each worker thread takes responsibility for computing Pearson *r* and p‑values for a subset of ticker pairs in parallel. This approach fully leverages multicore CPUs, reducing the correlation‐calculation step from roughly **35 s** in a single‐threaded run to just **9 s** in our multithreaded pipeline. The result is a highly responsive analysis engine that can scale to larger universes or higher update frequencies without long wait times.  
---
## Case Study: Airbnb (ABNB) Inverse Relationships

We pulled out the top 4 ABNB inverse pairs (|r| ≥ 0.13, p ≈ 0.25–0.37) and plotted their normalized‑price series:

| Pair             | Correlation | p‑Value | Chart                                                 |
|------------------|------------:|--------:|-------------------------------------------------------|
| ABNB vs CPB      | −0.1343     | 0.2573  | ![ABNB vs CPB](price_plot_ABNB_CPB.png)      |
| ABNB vs SJM      | −0.1343     | 0.2574  | ![ABNB vs SJM](price_plot_ABNB_SJM.png)      |
| HUM vs ABNB      | −0.1313     | 0.2681  | ![HUM vs ABNB](price_plot_HUM_ABNB.png)      |
| NOC vs ABNB      | −0.1073     | 0.3660  | ![NOC vs ABNB](price_plot_NOC_ABNB.png)      |

## Why These Inverse Relationships Persist

During economic downturns, geopolitical uncertainty, or sudden market shocks, investors routinely rotate capital out of high‑beta, discretionary stocks and into “defensive” sectors businesses whose revenues and cash flows are more stable when consumer confidence falls. This sector rotation dynamic explains the negative correlations we observe between Airbnb (ABNB) and the following names:

### Consumer Staples vs. Travel & Leisure
- **CPB (Campbell Soup)** & **SJM (J.M. Smucker)**  
  - Sell everyday food staples that remain in demand even when households tighten their budgets.  
  - In risk‑off environments, money flows **into** staples and **out of** discretionary travel plays like ABNB, causing CPB/SJM to outperform as ABNB lags.

### Health Care as a Safe Harbor
- **HUM (Humana)**  
  - Operates in health insurance, a sector underpinned by necessity rather than consumer sentiment.  
  - When growth names retreat, investors seek the predictability of healthcare revenues lifting HUM even as ABNB underperforms.

### Defense & Industrial Resilience
- **NOC (Northrop Grumman)**  
  - Holds long‑term, government backed contracts with revenue streams less tied to consumer spending.  
  - In periods of macro or geopolitical stress, defense names attract “safe‑haven” flows, driving NOC higher while ABNB weathers the downturn.

---

**In summary:**  
1. **Risk‑off rotation** pushes capital into staples, healthcare, and defense—sectors that can maintain or grow revenues in weak economic conditions.  
2. **Discretionary travel & leisure names** like Airbnb see demand—and share prices drop first when consumers retrench.  
3. The result is a modest but consistent **inverse correlation** between ABNB and each of CPB, SJM, HUM, and NOC.  

